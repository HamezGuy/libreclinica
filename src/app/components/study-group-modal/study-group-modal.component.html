<!-- Study Group Modal -->
<div class="modal-overlay" *ngIf="show" (click)="onBackdropClick($event)">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <i class="material-icons">group</i>
        {{ isEditMode ? 'Edit' : 'Create' }} Study Group
        <span class="study-name" *ngIf="study">for {{ study.title }}</span>
      </h2>
      <button class="close-button" (click)="onClose()" [disabled]="isSubmitting">
        <i class="material-icons">close</i>
      </button>
    </div>
    
    <div class="modal-body">
      <form [formGroup]="groupForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="name">
            Group Name
            <span class="required">*</span>
          </label>
          <input 
            type="text"
            id="name"
            formControlName="name"
            class="form-control"
            placeholder="e.g., Control Group, Treatment Group A"
            [class.error]="groupForm.get('name')?.invalid && groupForm.get('name')?.touched">
          <div class="error-message" *ngIf="groupForm.get('name')?.invalid && groupForm.get('name')?.touched">
            <span *ngIf="groupForm.get('name')?.errors?.['required']">Group name is required</span>
            <span *ngIf="groupForm.get('name')?.errors?.['minlength']">Group name must be at least 3 characters</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="description">
            Description
            <span class="required">*</span>
          </label>
          <textarea 
            id="description"
            formControlName="description"
            class="form-control"
            rows="3"
            placeholder="Describe the purpose and characteristics of this group"
            [class.error]="groupForm.get('description')?.invalid && groupForm.get('description')?.touched">
          </textarea>
          <div class="error-message" *ngIf="groupForm.get('description')?.invalid && groupForm.get('description')?.touched">
            <span *ngIf="groupForm.get('description')?.errors?.['required']">Description is required</span>
            <span *ngIf="groupForm.get('description')?.errors?.['minlength']">Description must be at least 10 characters</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="criteria">
            Inclusion/Exclusion Criteria
            <span class="required">*</span>
          </label>
          <textarea 
            id="criteria"
            formControlName="criteria"
            class="form-control"
            rows="4"
            placeholder="Define the criteria for patient inclusion in this group"
            [class.error]="groupForm.get('criteria')?.invalid && groupForm.get('criteria')?.touched">
          </textarea>
          <div class="error-message" *ngIf="groupForm.get('criteria')?.invalid && groupForm.get('criteria')?.touched">
            <span *ngIf="groupForm.get('criteria')?.errors?.['required']">Criteria is required</span>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="targetSize">
              Target Size
              <span class="required">*</span>
            </label>
            <input 
              type="number"
              id="targetSize"
              formControlName="targetSize"
              class="form-control"
              placeholder="Number of participants"
              min="1"
              max="1000"
              [class.error]="groupForm.get('targetSize')?.invalid && groupForm.get('targetSize')?.touched">
            <div class="error-message" *ngIf="groupForm.get('targetSize')?.invalid && groupForm.get('targetSize')?.touched">
              <span *ngIf="groupForm.get('targetSize')?.errors?.['required']">Target size is required</span>
              <span *ngIf="groupForm.get('targetSize')?.errors?.['min']">Target size must be at least 1</span>
              <span *ngIf="groupForm.get('targetSize')?.errors?.['max']">Target size cannot exceed 1000</span>
            </div>
          </div>
          
          <div class="form-group">
            <label for="status">
              Status
              <span class="required">*</span>
            </label>
            <select 
              id="status"
              formControlName="status"
              class="form-control"
              [class.error]="groupForm.get('status')?.invalid && groupForm.get('status')?.touched">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="full">Full</option>
            </select>
            <div class="error-message" *ngIf="groupForm.get('status')?.invalid && groupForm.get('status')?.touched">
              <span *ngIf="groupForm.get('status')?.errors?.['required']">Status is required</span>
            </div>
          </div>
        </div>
        
        <div class="info-box" *ngIf="group">
          <div class="info-item">
            <i class="material-icons">people</i>
            <span>Current Size: {{ group.currentSize || 0 }} / {{ groupForm.get('targetSize')?.value }}</span>
          </div>
          <div class="info-item">
            <i class="material-icons">event</i>
            <span>Created: {{ group.createdAt | date:'short' }}</span>
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="onClose()" [disabled]="isSubmitting">
        Cancel
      </button>
      <button 
        class="btn btn-primary" 
        (click)="onSubmit()"
        [disabled]="groupForm.invalid || isSubmitting">
        <span *ngIf="!isSubmitting">{{ isEditMode ? 'Update' : 'Create' }} Group</span>
        <span *ngIf="isSubmitting">
          <i class="material-icons spin">refresh</i>
          {{ isEditMode ? 'Updating' : 'Creating' }}...
        </span>
      </button>
    </div>
  </div>
</div>
