<!-- Organization Registration Wizard -->
<div class="organization-registration-container">
  
  <!-- Header -->
  <div class="registration-header">
    <div class="header-content">
      <h1>
        <i class="material-icons">domain</i>
        Organization Registration
      </h1>
      <p class="subtitle">Secure onboarding for clinical research organizations</p>
    </div>
    
    <!-- Progress Bar -->
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="stepProgress"></div>
      </div>
      <div class="step-indicators">
        <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
          <span class="step-number">1</span>
          <span class="step-label">Create Organization</span>
        </div>
        <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
          <span class="step-number">2</span>
          <span class="step-label">Verify Organization</span>
        </div>
        <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
          <span class="step-number">3</span>
          <span class="step-label">Complete Registration</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="registration-content">
    
    <!-- Step 1: Create Organization -->
    <div class="step-content" *ngIf="currentStep === 1">
      <div class="step-header">
        <h2>Create Your Organization</h2>
        <p>Set up your clinical research organization in our secure database.</p>
      </div>
      
      <form [formGroup]="organizationForm" (ngSubmit)="createOrganization()" class="organization-form">
        
        <!-- Basic Information -->
        <div class="form-section">
          <h3>Basic Information</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="name">Organization Name *</label>
              <input 
                type="text" 
                id="name" 
                formControlName="name"
                [class.error]="isFieldInvalid(organizationForm, 'name')"
                placeholder="Enter your organization's legal name">
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'name')">
                {{ getFieldError(organizationForm, 'name') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="displayName">Display Name</label>
              <input 
                type="text" 
                id="displayName" 
                formControlName="displayName"
                placeholder="Public-facing name (optional)">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="type">Organization Type *</label>
              <select 
                id="type" 
                formControlName="type"
                [class.error]="isFieldInvalid(organizationForm, 'type')">
                <option value="">Select organization type</option>
                <option *ngFor="let type of organizationTypes" [value]="type.value">
                  {{ type.label }}
                </option>
              </select>
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'type')">
                {{ getFieldError(organizationForm, 'type') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="tier">Subscription Tier *</label>
              <select id="tier" formControlName="tier">
                <option *ngFor="let tier of organizationTiers" [value]="tier.value">
                  {{ tier.label }} - {{ tier.description }}
                </option>
              </select>
            </div>
          </div>
        </div>
        
        <!-- Contact Information -->
        <div class="form-section">
          <h3>Contact Information</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="contactEmail">Contact Email *</label>
              <input 
                type="email" 
                id="contactEmail" 
                formControlName="contactEmail"
                [class.error]="isFieldInvalid(organizationForm, 'contactEmail')"
                placeholder="primary@organization.com">
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'contactEmail')">
                {{ getFieldError(organizationForm, 'contactEmail') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="contactPhone">Phone Number</label>
              <input 
                type="tel" 
                id="contactPhone" 
                formControlName="contactPhone"
                placeholder="+1 (555) 123-4567">
            </div>
          </div>
          
          <div class="form-group">
            <label for="website">Website</label>
            <input 
              type="url" 
              id="website" 
              formControlName="website"
              placeholder="https://www.organization.com">
          </div>
        </div>
        
        <!-- Address -->
        <div class="form-section">
          <h3>Address</h3>
          
          <div class="form-group">
            <label for="street">Street Address *</label>
            <input 
              type="text" 
              id="street" 
              formControlName="street"
              [class.error]="isFieldInvalid(organizationForm, 'street')"
              placeholder="123 Medical Center Drive">
            <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'street')">
              {{ getFieldError(organizationForm, 'street') }}
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="city">City *</label>
              <input 
                type="text" 
                id="city" 
                formControlName="city"
                [class.error]="isFieldInvalid(organizationForm, 'city')"
                placeholder="City">
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'city')">
                {{ getFieldError(organizationForm, 'city') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="state">State/Province *</label>
              <input 
                type="text" 
                id="state" 
                formControlName="state"
                [class.error]="isFieldInvalid(organizationForm, 'state')"
                placeholder="State">
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'state')">
                {{ getFieldError(organizationForm, 'state') }}
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="postalCode">Postal Code *</label>
              <input 
                type="text" 
                id="postalCode" 
                formControlName="postalCode"
                [class.error]="isFieldInvalid(organizationForm, 'postalCode')"
                placeholder="12345">
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'postalCode')">
                {{ getFieldError(organizationForm, 'postalCode') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="country">Country *</label>
              <input 
                type="text" 
                id="country" 
                formControlName="country"
                [class.error]="isFieldInvalid(organizationForm, 'country')"
                placeholder="United States">
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'country')">
                {{ getFieldError(organizationForm, 'country') }}
              </div>
            </div>
          </div>
        </div>
        
        <!-- Security Settings -->
        <div class="form-section">
          <h3>Security Settings</h3>
          
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="allowSelfRegistration">
              <span class="checkmark"></span>
              Allow self-registration with verification key
            </label>
            
            <label class="checkbox-label">
              <input type="checkbox" formControlName="requireAdminApproval">
              <span class="checkmark"></span>
              Require admin approval for new users
            </label>
            
            <label class="checkbox-label">
              <input type="checkbox" formControlName="requireMFA">
              <span class="checkmark"></span>
              Require multi-factor authentication
            </label>
          </div>
        </div>
        
        <!-- Messages -->
        <div class="message success" *ngIf="successMessage">
          <i class="material-icons">check_circle</i>
          {{ successMessage }}
        </div>
        
        <div class="message error" *ngIf="errorMessage">
          <i class="material-icons">error</i>
          {{ errorMessage }}
        </div>
        
        <!-- Actions -->
        <div class="step-actions">
          <button type="button" class="btn btn-secondary" (click)="cancelRegistration()">
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="organizationForm.invalid || isLoading">
            <i class="material-icons" *ngIf="isLoading">hourglass_empty</i>
            <i class="material-icons" *ngIf="!isLoading">arrow_forward</i>
            {{ isLoading ? 'Creating...' : 'Create Organization' }}
          </button>
        </div>
      </form>
    </div>
    
    <!-- Step 2: Verify Organization -->
    <div class="step-content" *ngIf="currentStep === 2">
      <div class="step-header">
        <h2>Verify Your Organization</h2>
        <p>Enter the verification key provided by your organization administrator.</p>
      </div>
      
      <form [formGroup]="verificationForm" (ngSubmit)="verifyOrganization()" class="verification-form">
        
        <div class="verification-info">
          <div class="info-card">
            <i class="material-icons">info</i>
            <div class="info-content">
              <h3>Verification Key Format</h3>
              <p>Your verification key should be in the format: <strong>WORD-WORD-0000</strong></p>
              <p>Example: <code>ALPHA-BRAVO-1234</code></p>
            </div>
          </div>
        </div>
        
        <div class="form-section">
          <div class="form-group">
            <label for="verificationKey">Organization Verification Key *</label>
            <input 
              type="text" 
              id="verificationKey" 
              formControlName="verificationKey"
              [class.error]="isFieldInvalid(verificationForm, 'verificationKey')"
              placeholder="ALPHA-BRAVO-1234"
              style="text-transform: uppercase;">
            <div class="error-message" *ngIf="isFieldInvalid(verificationForm, 'verificationKey')">
              {{ getFieldError(verificationForm, 'verificationKey') }}
            </div>
          </div>
          
          <div class="form-group">
            <label for="userEmail">Your Email Address *</label>
            <input 
              type="email" 
              id="userEmail" 
              formControlName="userEmail"
              [class.error]="isFieldInvalid(verificationForm, 'userEmail')"
              placeholder="your.email@domain.com">
            <div class="error-message" *ngIf="isFieldInvalid(verificationForm, 'userEmail')">
              {{ getFieldError(verificationForm, 'userEmail') }}
            </div>
          </div>
          
          <div class="form-group">
            <label for="displayName">Your Display Name *</label>
            <input 
              type="text" 
              id="displayName" 
              formControlName="displayName"
              [class.error]="isFieldInvalid(verificationForm, 'displayName')"
              placeholder="Dr. Jane Smith">
            <div class="error-message" *ngIf="isFieldInvalid(verificationForm, 'displayName')">
              {{ getFieldError(verificationForm, 'displayName') }}
            </div>
          </div>
        </div>
        
        <!-- Verified Organization Info -->
        <div class="verified-org-info" *ngIf="verifiedOrganization">
          <div class="success-card">
            <i class="material-icons">verified</i>
            <div class="org-details">
              <h3>{{ verifiedOrganization.displayName }}</h3>
              <p>{{ verifiedOrganization.type | titlecase }} Â· {{ verifiedOrganization.tier | titlecase }}</p>
              <p>{{ verifiedOrganization.contactInfo.email }}</p>
            </div>
          </div>
        </div>
        
        <!-- Messages -->
        <div class="message success" *ngIf="successMessage">
          <i class="material-icons">check_circle</i>
          {{ successMessage }}
        </div>
        
        <div class="message error" *ngIf="errorMessage">
          <i class="material-icons">error</i>
          {{ errorMessage }}
        </div>
        
        <!-- Actions -->
        <div class="step-actions">
          <button type="button" class="btn btn-secondary" (click)="previousStep()">
            <i class="material-icons">arrow_back</i>
            Back
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="verificationForm.invalid || isLoading">
            <i class="material-icons" *ngIf="isLoading">hourglass_empty</i>
            <i class="material-icons" *ngIf="!isLoading">verified_user</i>
            {{ isLoading ? 'Verifying...' : 'Verify Organization' }}
          </button>
        </div>
      </form>
    </div>
    
    <!-- Step 3: Complete Registration -->
    <div class="step-content" *ngIf="currentStep === 3">
      <div class="step-header">
        <h2>Complete Your Registration</h2>
        <p>Provide additional information to complete your account setup.</p>
      </div>
      
      <form [formGroup]="userRegistrationForm" (ngSubmit)="completeRegistration()" class="user-registration-form">
        
        <!-- Organization Summary -->
        <div class="organization-summary" *ngIf="verifiedOrganization">
          <h3>Joining Organization</h3>
          <div class="org-card">
            <div class="org-info">
              <h4>{{ verifiedOrganization.displayName }}</h4>
              <p>{{ verifiedOrganization.type | titlecase }}</p>
            </div>
            <div class="org-settings">
              <span class="setting" *ngIf="verifiedOrganization.settings.requireAdminApproval">
                <i class="material-icons">admin_panel_settings</i>
                Admin Approval Required
              </span>
              <span class="setting" *ngIf="verifiedOrganization.settings.requireMFA">
                <i class="material-icons">security</i>
                MFA Required
              </span>
            </div>
          </div>
        </div>
        
        <div class="form-section">
          <h3>Personal Information</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="userDisplayName">Display Name *</label>
              <input 
                type="text" 
                id="userDisplayName" 
                formControlName="displayName"
                [class.error]="isFieldInvalid(userRegistrationForm, 'displayName')"
                placeholder="Dr. Jane Smith">
              <div class="error-message" *ngIf="isFieldInvalid(userRegistrationForm, 'displayName')">
                {{ getFieldError(userRegistrationForm, 'displayName') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="jobTitle">Job Title</label>
              <input 
                type="text" 
                id="jobTitle" 
                formControlName="jobTitle"
                placeholder="Principal Investigator">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="department">Department</label>
              <input 
                type="text" 
                id="department" 
                formControlName="department"
                placeholder="Cardiology">
            </div>
            
            <div class="form-group">
              <label for="supervisorEmail">Supervisor Email</label>
              <input 
                type="email" 
                id="supervisorEmail" 
                formControlName="supervisorEmail"
                placeholder="supervisor@organization.com">
            </div>
          </div>
        </div>
        
        <!-- Role Selection -->
        <div class="form-section">
          <h3>Requested Access Level</h3>
          
          <div class="role-selection">
            <div class="role-option" *ngFor="let role of accessLevels">
              <label class="radio-label">
                <input type="radio" [value]="role.value" formControlName="requestedRole">
                <span class="radio-mark"></span>
                <div class="role-info">
                  <h4>{{ role.label }}</h4>
                  <p>{{ role.description }}</p>
                </div>
              </label>
            </div>
          </div>
        </div>
        
        <!-- Reason for Access -->
        <div class="form-section">
          <div class="form-group">
            <label for="reasonForAccess">Reason for Access *</label>
            <textarea 
              id="reasonForAccess" 
              formControlName="reasonForAccess"
              [class.error]="isFieldInvalid(userRegistrationForm, 'reasonForAccess')"
              placeholder="Please describe why you need access to this organization's clinical data systems..."
              rows="4"></textarea>
            <div class="error-message" *ngIf="isFieldInvalid(userRegistrationForm, 'reasonForAccess')">
              {{ getFieldError(userRegistrationForm, 'reasonForAccess') }}
            </div>
          </div>
        </div>
        
        <!-- Messages -->
        <div class="message success" *ngIf="successMessage">
          <i class="material-icons">check_circle</i>
          {{ successMessage }}
        </div>
        
        <div class="message error" *ngIf="errorMessage">
          <i class="material-icons">error</i>
          {{ errorMessage }}
        </div>
        
        <!-- Actions -->
        <div class="step-actions">
          <button type="button" class="btn btn-secondary" (click)="previousStep()">
            <i class="material-icons">arrow_back</i>
            Back
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="userRegistrationForm.invalid || isLoading">
            <i class="material-icons" *ngIf="isLoading">hourglass_empty</i>
            <i class="material-icons" *ngIf="!isLoading">check</i>
            {{ isLoading ? 'Submitting...' : 'Complete Registration' }}
          </button>
        </div>
      </form>
    </div>
    
  </div>
  
  <!-- Footer -->
  <div class="registration-footer">
    <div class="footer-content">
      <p>
        <i class="material-icons">security</i>
        This registration process is secured with enterprise-grade encryption and complies with HIPAA, GDPR, and 21 CFR Part 11 requirements.
      </p>
      <div class="compliance-badges">
        <span class="badge">HIPAA</span>
        <span class="badge">GDPR</span>
        <span class="badge">21 CFR Part 11</span>
      </div>
    </div>
  </div>
  
</div>
