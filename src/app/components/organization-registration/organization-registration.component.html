<!-- Organization Registration Wizard -->
<div class="organization-registration-container">
  
  <!-- Header -->
  <div class="registration-header">
    <div class="header-content">
      <h1>
        <i class="material-icons">domain</i>{{ 'organization-registration.organization_registration' | translate }}</h1>
      <p class="subtitle">{{ 'organization-registration.secure_onboarding_for_clinical_research_organizati' | translate }}</p>
    </div>
    
    <!-- Progress Bar -->
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="stepProgress"></div>
      </div>
      <div class="step-indicators">
        <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
          <span class="step-number">1</span>
          <span class="step-label">{{ 'organization-registration.create_organization' | translate }}</span>
        </div>
        <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
          <span class="step-number">2</span>
          <span class="step-label">{{ 'organization-registration.verify_organization' | translate }}</span>
        </div>
        <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
          <span class="step-number">3</span>
          <span class="step-label">{{ 'organization-registration.complete_registration' | translate }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="registration-content">
    
    <!-- Step 1: Create Organization -->
    <div class="step-content" *ngIf="currentStep === 1">
      <div class="step-header">
        <h2>{{ 'organization-registration.create_your_organization' | translate }}</h2>
        <p>{{ 'organization-registration.set_up_your_clinical_research_organization_in_our_' | translate }}</p>
      </div>
      
      <form [formGroup]="organizationForm" (ngSubmit)="createOrganization()" class="organization-form">
        
        <!-- Basic Information -->
        <div class="form-section">
          <h3>{{ 'organization-registration.basic_information' | translate }}</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="name">{{ 'organization-registration.organization_name_' | translate }}</label>
              <input type="text" id="name" formControlName="name" [class.error]="isFieldInvalid(organizationForm, 'name')" [placeholder]="'organization-registration.enter_your_organizations_legal_name' | translate">
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'name')">
                {{ getFieldError(organizationForm, 'name') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="displayName">{{ 'organization-registration.display_name' | translate }}</label>
              <input type="text" id="displayName" formControlName="displayName" [placeholder]="'organization-registration.publicfacing_name_optional' | translate">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="type">{{ 'organization-registration.organization_type_' | translate }}</label>
              <select id="type" formControlName="type" [class.error]="isFieldInvalid(organizationForm, 'type')">
                <option value="">{{ 'organization-registration.select_organization_type' | translate }}</option>
                <option *ngFor="let dept of departments" [value]="dept.value">
                  {{ dept.label }}
                </option>
              </select>
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'type')">
                {{ getFieldError(organizationForm, 'type') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="tier">{{ 'organization-registration.subscription_tier_' | translate }}</label>
              <select id="tier" formControlName="tier">
                <option *ngFor="let tier of organizationTiers" [value]="tier.value">
                  {{ tier.label }} - {{ tier.description }}
                </option>
              </select>
            </div>
          </div>
        </div>
        
        <!-- Contact Information -->
        <div class="form-section">
          <h3>{{ 'organization-registration.contact_information' | translate }}</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="contactEmail">{{ 'organization-registration.contact_email_' | translate }}</label>
              <input type="email" id="contactEmail" formControlName="email" [class.error]="isFieldInvalid(organizationForm, 'email')" [placeholder]="'organization-registration.primaryorganizationcom' | translate">
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'email')">
                {{ getFieldError(organizationForm, 'email') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="contactPhone">{{ 'organization-registration.phone_number' | translate }}</label>
              <input type="tel" id="contactPhone" formControlName="phone" placeholder="+1 (555) 123-4567">
            </div>
          </div>
          
          <div class="form-group">
            <label for="website">{{ 'organization-registration.website' | translate }}</label>
            <input type="url" id="website" formControlName="website" placeholder="https://www.organization.com">
          </div>
        </div>
        
        <!-- Address -->
        <div class="form-section">
          <h3>{{ 'organization-registration.address' | translate }}</h3>
          
          <div class="form-group">
            <label for="street">{{ 'organization-registration.street_address_' | translate }}</label>
            <input type="text" id="street" formControlName="street" [class.error]="isFieldInvalid(organizationForm, 'street')" [placeholder]="'organization-registration.123_medical_center_drive' | translate">
            <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'street')">
              {{ getFieldError(organizationForm, 'street') }}
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="city">{{ 'organization-registration.city_' | translate }}</label>
              <input type="text" id="city" formControlName="city" [class.error]="isFieldInvalid(organizationForm, 'city')" [placeholder]="'organization-registration.city' | translate">
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'city')">
                {{ getFieldError(organizationForm, 'city') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="firstName">{{ 'organization-registration.first_name_' | translate }}</label>
              <input type="text" id="lastName" formControlName="lastName" [class.error]="isFieldInvalid(organizationForm, 'firstName')" [placeholder]="'organization-registration.first_name' | translate">
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'firstName')">
                {{ getFieldError(organizationForm, 'firstName') }}
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="postalCode">{{ 'organization-registration.postal_code_' | translate }}</label>
              <input type="text" id="postalCode" formControlName="postalCode" [class.error]="isFieldInvalid(organizationForm, 'postalCode')" placeholder="12345">
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'postalCode')">
                {{ getFieldError(organizationForm, 'postalCode') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="country">{{ 'organization-registration.country_' | translate }}</label>
              <input type="text" id="country" formControlName="country" [class.error]="isFieldInvalid(organizationForm, 'country')" [placeholder]="'organization-registration.united_states' | translate">
              <div class="error-message" *ngIf="isFieldInvalid(organizationForm, 'country')">
                {{ getFieldError(organizationForm, 'country') }}
              </div>
            </div>
          </div>
        </div>
        
        <!-- Security Settings -->
        <div class="form-section">
          <h3>{{ 'organization-registration.security_settings' | translate }}</h3>
          
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="allowSelfRegistration">
              <span class="checkmark"></span>{{ 'organization-registration.allow_selfregistration_with_verification_key' | translate }}</label>
            
            <label class="checkbox-label">
              <input type="checkbox" formControlName="requireAdminApproval">
              <span class="checkmark"></span>{{ 'organization-registration.require_admin_approval_for_new_users' | translate }}</label>
            
            <label class="checkbox-label">
              <input type="checkbox" formControlName="requireMFA">
              <span class="checkmark"></span>{{ 'organization-registration.require_multifactor_authentication' | translate }}</label>
          </div>
        </div>
        
        <!-- Messages -->
        <div class="message success" *ngIf="successMessage">
          <i class="material-icons">check_circle</i>
          {{ successMessage }}
        </div>
        
        <div class="message error" *ngIf="errorMessage">
          <i class="material-icons">error</i>
          {{ errorMessage }}
        </div>
        
        <!-- Actions -->
        <div class="step-actions">
          <button type="button" class="btn btn-secondary" (click)="cancelRegistration()">{{ 'common.cancel' | translate }}</button>
          <button type="submit" class="btn btn-primary" [disabled]="organizationForm.invalid || isLoading">
            <i class="material-icons" *ngIf="isLoading">{{ 'organization-registration.hourglassempty' | translate }}</i>
            <i class="material-icons" *ngIf="!isLoading">arrow_forward</i>
            {{ isLoading ? 'Creating...' : 'Create Organization' }}
          </button>
        </div>
      </form>
    </div>
    
    <!-- Step 2: Verify Organization -->
    <div class="step-content" *ngIf="currentStep === 2">
      <div class="step-header">
        <h2>{{ 'organization-registration.verify_your_organization' | translate }}</h2>
        <p>{{ 'organization-registration.enter_the_verification_key_provided_by_your_organi' | translate }}</p>
      </div>
      
      <form [formGroup]="verificationForm" (ngSubmit)="verifyOrganization()" class="verification-form">
        
        <div class="verification-info">
          <div class="info-card">
            <i class="material-icons">info</i>
            <div class="info-content">
              <h3>{{ 'organization-registration.verification_key_format' | translate }}</h3>
              <p>{{ 'organization-registration.your_verification_key_should_be_in_the_format' | translate }}<strong>{{ 'organization-registration.wordword0000' | translate }}</strong></p>
              <p>{{ 'organization-registration.example' | translate }}<code>{{ 'organization-registration.alphabravo1234' | translate }}</code></p>
            </div>
          </div>
        </div>
        
        <div class="form-section">
          <div class="form-group">
            <label for="verificationKey">{{ 'organization-registration.organization_verification_key_' | translate }}</label>
            <input type="text" id="verificationKey" formControlName="verificationKey" class="large-input" [class.error]="isFieldInvalid(verificationForm, 'verificationKey')" style="text-transform: uppercase;" [placeholder]="'organization-registration.alphabravo1234' | translate">
            <div class="error-message" *ngIf="isFieldInvalid(verificationForm, 'verificationKey')">
              {{ getFieldError(verificationForm, 'verificationKey') }}
            </div>
          </div>
          
          <div class="form-group">
            <label for="userEmail">{{ 'organization-registration.your_email_address_' | translate }}</label>
            <input type="email" id="userEmail" formControlName="userEmail" [class.error]="isFieldInvalid(verificationForm, 'userEmail')" [placeholder]="'organization-registration.youremaildomaincom' | translate">
            <div class="error-message" *ngIf="isFieldInvalid(verificationForm, 'userEmail')">
              {{ getFieldError(verificationForm, 'userEmail') }}
            </div>
          </div>
          
          <div class="form-group">
            <label for="displayName">{{ 'organization-registration.your_display_name_' | translate }}</label>
            <input type="text" id="displayName" formControlName="displayName" [class.error]="isFieldInvalid(verificationForm, 'displayName')" [placeholder]="'organization-registration.dr_jane_smith' | translate">
            <div class="error-message" *ngIf="isFieldInvalid(verificationForm, 'displayName')">
              {{ getFieldError(verificationForm, 'displayName') }}
            </div>
          </div>
        </div>
        
        <!-- Verified Organization Info -->
        <div class="verified-org-info" *ngIf="verifiedOrganization">
          <div class="success-card">
            <i class="material-icons">verified</i>
            <div class="org-details">
              <h3>{{ verifiedOrganization.displayName }}</h3>
              <p>{{ verifiedOrganization.type | titlecase }} Â· {{ verifiedOrganization.tier | titlecase }}</p>
              <p>{{ verifiedOrganization.contactInfo.email }}</p>
            </div>
          </div>
        </div>
        
        <!-- Messages -->
        <div class="message success" *ngIf="successMessage">
          <i class="material-icons">check_circle</i>
          {{ successMessage }}
        </div>
        
        <div class="message error" *ngIf="errorMessage">
          <i class="material-icons">error</i>
          {{ errorMessage }}
        </div>
        
        <!-- Actions -->
        <div class="step-actions">
          <button type="button" class="btn btn-secondary" (click)="previousStep()">
            <i class="material-icons">arrow_back</i>{{ 'common.back' | translate }}</button>
          <button type="submit" class="btn btn-primary" [disabled]="verificationForm.invalid || isLoading">
            <i class="material-icons" *ngIf="isLoading">{{ 'organization-registration.hourglassempty' | translate }}</i>
            <i class="material-icons" *ngIf="!isLoading">verified_user</i>
            {{ isLoading ? 'Verifying...' : 'Verify Organization' }}
          </button>
        </div>
      </form>
    </div>
    
    <!-- Step 3: Complete Registration -->
    <div class="step-content" *ngIf="currentStep === 3">
      <div class="step-header">
        <h2>{{ 'organization-registration.complete_your_registration' | translate }}</h2>
        <p>{{ 'organization-registration.provide_additional_information_to_complete_your_ac' | translate }}</p>
      </div>
      
      <form [formGroup]="userRegistrationForm" (ngSubmit)="completeRegistration()" class="user-registration-form">
        
        <!-- Organization Summary -->
        <div class="organization-summary" *ngIf="verifiedOrganization">
          <h3>{{ 'organization-registration.joining_organization' | translate }}</h3>
          <div class="org-card">
            <div class="org-info">
              <h4>{{ verifiedOrganization.displayName }}</h4>
              <p>{{ verifiedOrganization.type | titlecase }}</p>
            </div>
            <div class="org-settings">
              <span class="setting" *ngIf="verifiedOrganization.settings.requireAdminApproval">
                <i class="material-icons">admin_panel_settings</i>{{ 'organization-registration.admin_approval_required' | translate }}</span>
              <span class="setting" *ngIf="verifiedOrganization.settings.requireMFA">
                <i class="material-icons">security</i>{{ 'organization-registration.mfa_enabled' | translate }}</span>
            </div>
          </div>
        </div>
        
        <div class="form-section">
          <h3>{{ 'organization-registration.personal_information' | translate }}</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="userDisplayName">{{ 'organization-registration.display_name_' | translate }}</label>
              <input type="text" id="userDisplayName" formControlName="displayName" [class.error]="isFieldInvalid(userRegistrationForm, 'displayName')" [placeholder]="'organization-registration.dr_jane_smith' | translate">
              <div class="error-message" *ngIf="isFieldInvalid(userRegistrationForm, 'displayName')">
                {{ getFieldError(userRegistrationForm, 'displayName') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="jobTitle">{{ 'organization-registration.job_title' | translate }}</label>
              <input type="text" id="jobTitle" formControlName="jobTitle" [placeholder]="'organization-registration.principal_investigator' | translate">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="department">{{ 'organization-registration.department' | translate }}</label>
              <select id="department" formControlName="department">
                <option value="">{{ 'organization-registration.cardiology' | translate }}</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="supervisorEmail">{{ 'organization-registration.supervisor_email' | translate }}</label>
              <input type="email" id="supervisorEmail" formControlName="supervisorEmail" [placeholder]="'organization-registration.supervisororganizationcom' | translate">
            </div>
          </div>
        </div>
        
        <!-- Role Selection -->
        <div class="form-section">
          <h3>{{ 'organization-registration.requested_access_level' | translate }}</h3>
          
          <div class="role-selection">
            <div class="role-option" *ngFor="let role of accessLevels">
              <label class="radio-label">
                <input type="radio" [value]="role.value" formControlName="requestedRole">
                <span class="radio-mark"></span>
                <div class="role-info">
                  <h4>{{ role.label }}</h4>
                  <p>{{ role.description }}</p>
                </div>
              </label>
            </div>
          </div>
        </div>
        
        <!-- Reason for Access -->
        <div class="form-section">
          <div class="form-group">
            <label for="reasonForAccess">{{ 'organization-registration.reason_for_access_' | translate }}</label>
            <textarea id="reasonForAccess" formControlName="reasonForAccess" [class.error]="isFieldInvalid(userRegistrationForm, 'reasonForAccess')" rows="4" [placeholder]="'organization-registration.please_describe_why_you_need_access_to_this_organi' | translate"></textarea>
            <div class="error-message" *ngIf="isFieldInvalid(userRegistrationForm, 'reasonForAccess')">
              {{ getFieldError(userRegistrationForm, 'reasonForAccess') }}
            </div>
          </div>
        </div>
        
        <!-- Messages -->
        <div class="message success" *ngIf="successMessage">
          <i class="material-icons">check_circle</i>
          {{ successMessage }}
        </div>
        
        <div class="message error" *ngIf="errorMessage">
          <i class="material-icons">error</i>
          {{ errorMessage }}
        </div>
        
        <!-- Actions -->
        <div class="step-actions">
          <button type="button" class="btn btn-secondary" (click)="previousStep()">
            <i class="material-icons">arrow_back</i>{{ 'common.back' | translate }}</button>
          <button type="submit" class="btn btn-primary" [disabled]="userRegistrationForm.invalid || isLoading">
            <i class="material-icons" *ngIf="isLoading">hourglass_empty</i>
            <i class="material-icons" *ngIf="!isLoading">check</i>
            {{ isLoading ? 'Submitting...' : 'Complete Registration' }}
          </button>
        </div>
      </form>
    </div>
    
  </div>
  
  <!-- Footer -->
  <div class="registration-footer">
    <div class="footer-content">
      <p>
        <i class="material-icons">{{ 'organization-registration.security' | translate }}</i>{{ 'organization-registration.this_registration_process_is_secured_with_enterpri' | translate }}</p>
      <div class="compliance-badges">
        <span class="badge">{{ 'organization-registration.hipaa' | translate }}</span>
        <span class="badge">{{ 'organization-registration.gdpr' | translate }}</span>
        <span class="badge">{{ 'organization-registration.21_cfr_part_11' | translate }}</span>
      </div>
    </div>
  </div>
  
</div>
</body></html>