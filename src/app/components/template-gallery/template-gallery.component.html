<div class="template-gallery">
  <div class="gallery-grid">
    <div class="template-card" *ngFor="let template of templates" [class.selected]="template.id &amp;&amp; isSelected(template.id)" (click)="onTemplateClick(template)">
      
      <!-- Template Preview Area -->
      <div class="template-preview">
        <div class="template-icon">
          <i class="material-icons">{{ getTemplateIcon(template) }}</i>
        </div>
        
        <!-- Mini Form Preview -->
        <div class="mini-form-preview">
          <div class="form-field-preview" *ngFor="let field of template.fields.slice(0, 3)">
            <div class="field-label">{{ field.label }}</div>
            <div class="field-input" [ngSwitch]="field.type">
              <div *ngSwitchCase="'text'" class="input-preview"></div>
              <div *ngSwitchCase="'number'" class="input-preview number"></div>
              <div *ngSwitchCase="'date'" class="input-preview date">
                <i class="material-icons">calendar_today</i>
              </div>
              <div *ngSwitchCase="'select'" class="input-preview select">
                <i class="material-icons">arrow_drop_down</i>
              </div>
              <div *ngSwitchCase="'checkbox'" class="checkbox-preview">
                <span class="checkbox"></span>
              </div>
              <div *ngSwitchCase="'radio'" class="radio-preview">
                <span class="radio"></span>
              </div>
              <div *ngSwitchDefault class="input-preview"></div>
            </div>
          </div>
          
          <div class="more-fields" *ngIf="template.fields.length > 3">
            +{{ template.fields.length - 3 }} more fields
          </div>
        </div>
      </div>
      
      <!-- Template Info -->
      <div class="template-info">
        <h4 class="template-name">{{ template.name }}</h4>
        <p class="template-description">{{ template.description || 'No description available' }}</p>
        
        <div class="template-meta">
          <span class="template-type">{{ getTemplateTypeLabel(template) }}</span>
          <span class="field-count">
            <i class="material-icons">input</i>
            {{ template.fields.length }} fields
          </span>
        </div>
        
        <div class="template-badges">
          <span class="badge badge-phi" *ngIf="template.isPatientTemplate || template.isStudySubjectTemplate">
            <i class="material-icons">lock</i>{{ 'template.phi' | translate }}</span>
          <span class="badge badge-version">
            v{{ template.version }}
          </span>
          <span class="badge badge-status" [class.published]="template.status === 'published'">
            {{ template.status }}
          </span>
        </div>
      </div>
      
      <!-- Selected Indicator -->
      <div class="selected-indicator" *ngIf="template.id &amp;&amp; isSelected(template.id)">
        <i class="material-icons">check_circle</i>
      </div>
    </div>
  </div>
  
  <!-- Empty State -->
  <div class="empty-state" *ngIf="templates.length === 0">
    <i class="material-icons">folder_open</i>
    <p>{{ 'template.no_templates_available' | translate }}</p>
  </div>
</div>

<!-- Template Preview Modal -->
<div class="preview-modal" *ngIf="showPreview &amp;&amp; previewTemplate as pt" (click)="closePreview()">
  <div class="preview-content" (click)="$event.stopPropagation()">
    <div class="preview-header">
      <h2>{{ pt.name }}</h2>
      <button class="close-btn" (click)="closePreview()">
        <i class="material-icons">close</i>
      </button>
    </div>
    
    <div class="preview-body">
      <app-form-preview [template]="pt" [readonly]="true">
      </app-form-preview>
    </div>
    
    <div class="preview-footer">
      <button class="btn btn-secondary" (click)="closePreview()">{{ 'common.cancel' | translate }}</button>
      <button class="btn btn-primary" (click)="onSelectTemplate(pt)">
        <i class="material-icons">add</i>{{ 'template.add_to_phase' | translate }}</button>
    </div>
  </div>
</div>