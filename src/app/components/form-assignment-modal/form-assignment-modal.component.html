<!-- Form Assignment Modal --><html><head></head><body><div class="modal-overlay" *ngif="show" (click)="onBackdropClick($event)">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <i class="material-icons">{{ 'form-assignment-modal.assignment' | translate }}</i>
        {{ isEditMode ? 'Edit' : 'Assign' }} Form to Study
        <span class="study-name" *ngif="study">{{ study.title }}</span>
      </h2>
      <button class="close-button" (click)="onClose()" [disabled]="isSubmitting">
        <i class="material-icons">{{ 'common.close' | translate }}</i>
      </button>
    </div>
    
    <div class="modal-body">
      <form [formgroup]="assignmentForm" (ngsubmit)="onSubmit()">
        <div class="form-group">
          <label for="formTemplateId">{{ 'form-assignment-modal.form_template' | translate }}<span class="required">*</span>
          </label>
          <select id="formTemplateId" formcontrolname="formTemplateId" class="form-control" [class.error]="assignmentForm.get('formTemplateId')?.invalid &amp;&amp; assignmentForm.get('formTemplateId')?.touched">
            <option value="">{{ 'form-assignment-modal.select_a_form_template' | translate }}</option>
            <option *ngfor="let template of availableTemplates" [value]="template.id">
              {{ template.name }} ({{ template.category }})
            </option>
          </select>
          <div class="error-message" *ngif="assignmentForm.get('formTemplateId')?.invalid &amp;&amp; assignmentForm.get('formTemplateId')?.touched">
            <span *ngif="assignmentForm.get('formTemplateId')?.errors?.['required']">{{ 'form-assignment-modal.form_template_is_required' | translate }}</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="sectionId">{{ 'form-assignment-modal.study_section' | translate }}<span class="required">*</span>
          </label>
          <select id="sectionId" formcontrolname="sectionId" class="form-control" [class.error]="assignmentForm.get('sectionId')?.invalid &amp;&amp; assignmentForm.get('sectionId')?.touched">
            <option value="">{{ 'form-assignment-modal.select_a_section' | translate }}</option>
            <option *ngfor="let section of filteredSections" [value]="section.id">
              {{ section.name }}
            </option>
          </select>
          <div class="error-message" *ngif="assignmentForm.get('sectionId')?.invalid &amp;&amp; assignmentForm.get('sectionId')?.touched">
            <span *ngif="assignmentForm.get('sectionId')?.errors?.['required']">{{ 'form-assignment-modal.study_section_is_required' | translate }}</span>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="assignmentType">{{ 'form-assignment-modal.assignment_type' | translate }}<span class="required">*</span>
            </label>
            <select id="assignmentType" formcontrolname="assignmentType" class="form-control" [class.error]="assignmentForm.get('assignmentType')?.invalid &amp;&amp; assignmentForm.get('assignmentType')?.touched">
              <option *ngfor="let type of assignmentTypes" [value]="type.value">
                {{ type.label }}
              </option>
            </select>
            <div class="error-message" *ngif="assignmentForm.get('assignmentType')?.invalid &amp;&amp; assignmentForm.get('assignmentType')?.touched">
              <span *ngif="assignmentForm.get('assignmentType')?.errors?.['required']">{{ 'form-assignment-modal.assignment_type_is_required' | translate }}</span>
            </div>
          </div>
          
          <div class="form-group">
            <label for="frequency">{{ 'form-assignment-modal.frequency' | translate }}<span class="required">*</span>
            </label>
            <select id="frequency" formcontrolname="frequency" class="form-control" [class.error]="assignmentForm.get('frequency')?.invalid &amp;&amp; assignmentForm.get('frequency')?.touched">
              <option *ngfor="let freq of frequencies" [value]="freq.value">
                {{ freq.label }}
              </option>
            </select>
            <div class="error-message" *ngif="assignmentForm.get('frequency')?.invalid &amp;&amp; assignmentForm.get('frequency')?.touched">
              <span *ngif="assignmentForm.get('frequency')?.errors?.['required']">{{ 'form-assignment-modal.frequency_is_required' | translate }}</span>
            </div>
          </div>
        </div>
        
        <div class="form-group" *ngif="showConditionField">
          <label for="condition">{{ 'form-assignment-modal.condition' | translate }}<span class="required">*</span>
          </label>
          <textarea id="condition" formcontrolname="condition" class="form-control" rows="3" [class.error]="assignmentForm.get('condition')?.invalid &amp;&amp; assignmentForm.get('condition')?.touched" :placeholder="'form-assignment-modal.describe_the_condition_that_must_be_met_for_this_f' | translate">          </textarea>
          <div class="error-message" *ngif="assignmentForm.get('condition')?.invalid &amp;&amp; assignmentForm.get('condition')?.touched">
            <span *ngif="assignmentForm.get('condition')?.errors?.['required']">{{ 'form-assignment-modal.condition_is_required_for_conditional_assignments' | translate }}</span>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="order">{{ 'form-assignment-modal.display_order' | translate }}<span class="required">*</span>
            </label>
            <input type="number" id="order" formcontrolname="order" class="form-control" placeholder="1" min="1" [class.error]="assignmentForm.get('order')?.invalid &amp;&amp; assignmentForm.get('order')?.touched">
            <div class="error-message" *ngif="assignmentForm.get('order')?.invalid &amp;&amp; assignmentForm.get('order')?.touched">
              <span *ngif="assignmentForm.get('order')?.errors?.['required']">{{ 'form-assignment-modal.display_order_is_required' | translate }}</span>
              <span *ngif="assignmentForm.get('order')?.errors?.['min']">{{ 'form-assignment-modal.display_order_must_be_at_least_1' | translate }}</span>
            </div>
          </div>
          
          <div class="form-group" *ngif="showDueAfterField">
            <label for="dueAfterDays">{{ 'form-assignment-modal.due_after_days' | translate }}<span class="required">*</span>
            </label>
            <input type="number" id="dueAfterDays" formcontrolname="dueAfterDays" class="form-control" placeholder="0" min="0" [class.error]="assignmentForm.get('dueAfterDays')?.invalid &amp;&amp; assignmentForm.get('dueAfterDays')?.touched">
            <div class="error-message" *ngif="assignmentForm.get('dueAfterDays')?.invalid &amp;&amp; assignmentForm.get('dueAfterDays')?.touched">
              <span *ngif="assignmentForm.get('dueAfterDays')?.errors?.['required']">{{ 'form-assignment-modal.due_after_days_is_required' | translate }}</span>
              <span *ngif="assignmentForm.get('dueAfterDays')?.errors?.['min']">{{ 'form-assignment-modal.due_after_days_cannot_be_negative' | translate }}</span>
            </div>
          </div>
        </div>
        
        <div class="info-box">
          <i class="material-icons">{{ 'common.info' | translate }}</i>
          <div class="info-content">
            <p><strong>{{ 'form-assignment-modal.assignment_types' | translate }}</strong></p>
            <ul>
              <li><strong>{{ 'form-assignment-modal.required' | translate }}</strong>{{ 'form-assignment-modal.form_must_be_completed_by_all_participants' | translate }}</li>
              <li><strong>{{ 'form-assignment-modal.optional' | translate }}</strong>{{ 'form-assignment-modal.form_is_available_but_not_mandatory' | translate }}</li>
              <li><strong>{{ 'form-assignment-modal.conditional' | translate }}</strong>{{ 'form-assignment-modal.form_is_assigned_based_on_specific_criteria' | translate }}</li>
            </ul>
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="onClose()" [disabled]="isSubmitting">{{ 'common.cancel' | translate }}</button>
      <button class="btn btn-primary" (click)="onSubmit()" [disabled]="assignmentForm.invalid || isSubmitting">
        <span *ngif="!isSubmitting">{{ isEditMode ? 'Update' : 'Assign' }} Form</span>
        <span *ngif="isSubmitting">
          <i class="material-icons spin">{{ 'common.refresh' | translate }}</i>
          {{ isEditMode ? 'Updating' : 'Assigning' }}...
        </span>
      </button>
    </div>
  </div>
</div>
</body></html>