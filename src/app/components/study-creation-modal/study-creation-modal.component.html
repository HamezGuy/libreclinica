<!-- Study Creation Modal -->
<div class="modal-overlay" *ngIf="show" (click)="onBackdropClick($event)">
  <div class="modal-content large-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Create New Study</h2>
      <button class="close-button" (click)="onClose()" [disabled]="isCreatingStudy">
        <i class="material-icons">close</i>
      </button>
    </div>
    
    <form [formGroup]="studyCreationForm" (ngSubmit)="onSubmit()" class="study-creation-form">
      <div class="modal-body">
        <!-- Basic Information Section -->
        <div class="form-section">
          <h3>Basic Information</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="title">Study Title <span class="required">*</span></label>
              <input 
                type="text" 
                id="title" 
                formControlName="title" 
                class="form-control"
                placeholder="Enter study title">
              <div class="error-message" *ngIf="studyCreationForm.get('title')?.touched && studyCreationForm.get('title')?.errors">
                <span *ngIf="studyCreationForm.get('title')?.errors?.['required']">Study title is required</span>
                <span *ngIf="studyCreationForm.get('title')?.errors?.['minlength']">Title must be at least 5 characters</span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="protocolNumber">Protocol Number <span class="required">*</span></label>
              <input 
                type="text" 
                id="protocolNumber" 
                formControlName="protocolNumber" 
                class="form-control"
                placeholder="e.g., STUDY-2024-001">
              <div class="error-message" *ngIf="studyCreationForm.get('protocolNumber')?.touched && studyCreationForm.get('protocolNumber')?.errors">
                <span *ngIf="studyCreationForm.get('protocolNumber')?.errors?.['required']">Protocol number is required</span>
                <span *ngIf="studyCreationForm.get('protocolNumber')?.errors?.['pattern']">Use uppercase letters, numbers, and hyphens only</span>
              </div>
            </div>
          </div>
          
          <div class="form-group full-width">
            <label for="description">Study Description <span class="required">*</span></label>
            <textarea 
              id="description" 
              formControlName="description" 
              class="form-control" 
              rows="4"
              placeholder="Provide a detailed description of the study objectives and methodology">
            </textarea>
            <div class="error-message" *ngIf="studyCreationForm.get('description')?.touched && studyCreationForm.get('description')?.errors">
              <span *ngIf="studyCreationForm.get('description')?.errors?.['required']">Description is required</span>
              <span *ngIf="studyCreationForm.get('description')?.errors?.['minlength']">Description must be at least 20 characters</span>
            </div>
          </div>
        </div>
        
        <!-- Study Classification Section -->
        <div class="form-section">
          <h3>Study Classification</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="phase">Study Phase <span class="required">*</span></label>
              <select id="phase" formControlName="phase" class="form-control">
                <option value="">Select phase</option>
                <option *ngFor="let phase of studyPhases" [value]="phase.value">
                  {{ phase.label }}
                </option>
              </select>
              <div class="error-message" *ngIf="studyCreationForm.get('phase')?.touched && studyCreationForm.get('phase')?.errors?.['required']">
                Study phase is required
              </div>
            </div>
            
            <div class="form-group">
              <label for="status">Study Status <span class="required">*</span></label>
              <select id="status" formControlName="status" class="form-control">
                <option *ngFor="let status of studyStatuses" [value]="status.value">
                  {{ status.label }}
                </option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="therapeuticArea">Therapeutic Area <span class="required">*</span></label>
              <input 
                type="text" 
                id="therapeuticArea" 
                formControlName="therapeuticArea" 
                class="form-control"
                placeholder="e.g., Oncology, Cardiology">
              <div class="error-message" *ngIf="studyCreationForm.get('therapeuticArea')?.touched && studyCreationForm.get('therapeuticArea')?.errors?.['required']">
                Therapeutic area is required
              </div>
            </div>
            
            <div class="form-group">
              <label for="indication">Indication <span class="required">*</span></label>
              <input 
                type="text" 
                id="indication" 
                formControlName="indication" 
                class="form-control"
                placeholder="e.g., Type 2 Diabetes Mellitus">
              <div class="error-message" *ngIf="studyCreationForm.get('indication')?.touched && studyCreationForm.get('indication')?.errors?.['required']">
                Indication is required
              </div>
            </div>
          </div>
        </div>
        
        <!-- Enrollment Section -->
        <div class="form-section">
          <h3>Enrollment Information</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="plannedEnrollment">Planned Enrollment <span class="required">*</span></label>
              <input 
                type="number" 
                id="plannedEnrollment" 
                formControlName="plannedEnrollment" 
                class="form-control"
                min="1"
                placeholder="Number of subjects">
              <div class="error-message" *ngIf="studyCreationForm.get('plannedEnrollment')?.touched && studyCreationForm.get('plannedEnrollment')?.errors">
                <span *ngIf="studyCreationForm.get('plannedEnrollment')?.errors?.['required']">Planned enrollment is required</span>
                <span *ngIf="studyCreationForm.get('plannedEnrollment')?.errors?.['min']">Must be at least 1</span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="actualEnrollment">Actual Enrollment</label>
              <input 
                type="number" 
                id="actualEnrollment" 
                formControlName="actualEnrollment" 
                class="form-control"
                min="0"
                placeholder="Current enrolled">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="enrollmentStartDate">Enrollment Start Date <span class="required">*</span></label>
              <input 
                type="date" 
                id="enrollmentStartDate" 
                formControlName="enrollmentStartDate" 
                class="form-control">
              <div class="error-message" *ngIf="studyCreationForm.get('enrollmentStartDate')?.touched && studyCreationForm.get('enrollmentStartDate')?.errors?.['required']">
                Start date is required
              </div>
            </div>
            
            <div class="form-group">
              <label for="enrollmentEndDate">Enrollment End Date <span class="required">*</span></label>
              <input 
                type="date" 
                id="enrollmentEndDate" 
                formControlName="enrollmentEndDate" 
                class="form-control">
              <div class="error-message" *ngIf="studyCreationForm.get('enrollmentEndDate')?.touched && studyCreationForm.get('enrollmentEndDate')?.errors?.['required']">
                End date is required
              </div>
            </div>
          </div>
        </div>
        
        <!-- Study Team Section -->
        <div class="form-section">
          <h3>Study Team</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="principalInvestigator">Principal Investigator <span class="required">*</span></label>
              <input 
                type="text" 
                id="principalInvestigator" 
                formControlName="principalInvestigator" 
                class="form-control"
                placeholder="PI Name">
              <div class="error-message" *ngIf="studyCreationForm.get('principalInvestigator')?.touched && studyCreationForm.get('principalInvestigator')?.errors?.['required']">
                Principal Investigator is required
              </div>
            </div>
            
            <div class="form-group">
              <label for="studyCoordinator">Study Coordinator</label>
              <input 
                type="text" 
                id="studyCoordinator" 
                formControlName="studyCoordinator" 
                class="form-control"
                placeholder="Coordinator Name">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="dataManager">Data Manager</label>
              <input 
                type="text" 
                id="dataManager" 
                formControlName="dataManager" 
                class="form-control"
                placeholder="Data Manager Name">
            </div>
            
            <div class="form-group">
              <label for="monitor">Clinical Monitor</label>
              <input 
                type="text" 
                id="monitor" 
                formControlName="monitor" 
                class="form-control"
                placeholder="Monitor Name">
            </div>
          </div>
        </div>
        
        <!-- Regulatory Section -->
        <div class="form-section">
          <h3>Regulatory Information</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="irbApprovalNumber">IRB Approval Number</label>
              <input 
                type="text" 
                id="irbApprovalNumber" 
                formControlName="irbApprovalNumber" 
                class="form-control"
                placeholder="IRB Number">
            </div>
            
            <div class="form-group">
              <label for="irbApprovalDate">IRB Approval Date</label>
              <input 
                type="date" 
                id="irbApprovalDate" 
                formControlName="irbApprovalDate" 
                class="form-control">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="regulatoryBody">Regulatory Body</label>
              <input 
                type="text" 
                id="regulatoryBody" 
                formControlName="regulatoryBody" 
                class="form-control"
                placeholder="e.g., FDA, EMA">
            </div>
            
            <div class="form-group">
              <label for="clinicalTrialId">Clinical Trial ID</label>
              <input 
                type="text" 
                id="clinicalTrialId" 
                formControlName="clinicalTrialId" 
                class="form-control"
                placeholder="e.g., NCT12345678">
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="onClose()" [disabled]="isCreatingStudy">
          Cancel
        </button>
        <button 
          type="submit" 
          class="btn btn-primary" 
          [disabled]="studyCreationForm.invalid || isCreatingStudy">
          <span *ngIf="!isCreatingStudy">Create Study</span>
          <span *ngIf="isCreatingStudy">
            <i class="material-icons spin">refresh</i>
            Creating...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>
